// Scene, camera, renderer, and physics world setup
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);
const world = new CANNON.World();
world.gravity.set(0, -9.82, 0);

// Define the Motorbike class
class Motorbike {
    constructor(scene, world) {
        this.scene = scene;
        this.world = world;
        this.chassisMesh = new THREE.Mesh(new THREE.BoxGeometry(1, 0.5, 2), new THREE.MeshBasicMaterial({ color: 0xff0000 }));
        this.scene.add(this.chassisMesh);
        this.chassisBody = new CANNON.Body({ mass: 1 });
        this.chassisBody.addShape(new CANNON.Box(new CANNON.Vec3(0.5, 0.25, 1)));
        this.world.addBody(this.chassisBody);
    }
    update() {
        this.chassisMesh.position.copy(this.chassisBody.position);
        this.chassisMesh.quaternion.copy(this.chassisBody.quaternion);
    }
    applyControls(keys) {
        const force = new CANNON.Vec3();
        if (keys.ArrowUp) force.z = -10;
        if (keys.ArrowDown) force.z = 10;
        if (keys.ArrowLeft) this.chassisBody.angularVelocity.y = 1;
        if (keys.ArrowRight) this.chassisBody.angularVelocity.y = -1;
        this.chassisBody.applyLocalForce(force, new CANNON.Vec3(0, 0, 0));
    }
}

// Instantiate the motorbike
const motorbike = new Motorbike(scene, world);

// Set up keyboard event listeners
const keys = { ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false };
document.addEventListener('keydown', (event) => { if (event.key in keys) keys[event.key] = true; });
document.addEventListener('keyup', (event) => { if (event.key in keys) keys[event.key] = false; });

// Animation loop
function animate() {
    requestAnimationFrame(animate);
    world.step(1 / 60);

    // Update motorbike and camera
    motorbike.applyControls(keys);
    motorbike.update();
    const offset = new THREE.Vector3(0, 2, 5);
    const motorbikePosition = motorbike.chassisMesh.position;
    const motorbikeQuaternion = motorbike.chassisMesh.quaternion;
    const cameraPosition = motorbikePosition.clone().add(offset.applyQuaternion(motorbikeQuaternion));
    camera.position.copy(cameraPosition);
    camera.lookAt(motorbikePosition);

    renderer.render(scene, camera);
}
animate();
